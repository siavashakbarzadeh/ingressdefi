{"version":3,"file":"bs-daterangepicker-container.component.js","sources":["../../../../../../src/datepicker/themes/bs/bs-daterangepicker-container.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, ElementRef, EventEmitter, OnDestroy, OnInit, Renderer2 } from '@angular/core';\n\nimport { take } from 'rxjs/operators';\nimport { Subscription } from 'rxjs';\n\nimport { getFullYear, getMonth } from 'ngx-bootstrap/chronos';\nimport { PositioningService } from 'ngx-bootstrap/positioning';\n\nimport { BsDatepickerAbstractComponent } from '../../base/bs-datepicker-container';\nimport { BsDatepickerConfig } from '../../bs-datepicker.config';\nimport { CalendarCellViewModel, DayViewModel } from '../../models';\nimport { BsDatepickerActions } from '../../reducer/bs-datepicker.actions';\nimport { BsDatepickerEffects } from '../../reducer/bs-datepicker.effects';\nimport { BsDatepickerStore } from '../../reducer/bs-datepicker.store';\nimport { datepickerAnimation } from '../../datepicker-animations';\nimport { BsCustomDates } from './bs-custom-dates-view.component';\nimport { dayInMilliseconds } from '../../reducer/_defaults';\n\n@Component({\n  selector: 'bs-daterangepicker-container',\n  providers: [BsDatepickerStore, BsDatepickerEffects],\n  templateUrl: './bs-datepicker-view.html',\n  host: {\n    class: 'bottom',\n    '(click)': '_stopPropagation($event)',\n    role: 'dialog',\n    'aria-label': 'calendar'\n  },\n  animations: [datepickerAnimation]\n})\nexport class BsDaterangepickerContainerComponent extends BsDatepickerAbstractComponent\n  implements OnInit, OnDestroy {\n  set value(value: Date[]) {\n    this._effects?.setRangeValue(value);\n  }\n\n  valueChange = new EventEmitter<Date[]>();\n  animationState = 'void';\n\n  _rangeStack: Date[] = [];\n  chosenRange: Date[] = [];\n  _subs: Subscription[] = [];\n\n  constructor(\n    _renderer: Renderer2,\n    private _config: BsDatepickerConfig,\n    private _store: BsDatepickerStore,\n    private _element: ElementRef,\n    private _actions: BsDatepickerActions,\n    _effects: BsDatepickerEffects,\n    private _positionService: PositioningService\n  ) {\n    super();\n    this._effects = _effects;\n\n    this.customRanges = this._config.ranges || [];\n    this.customRangeBtnLbl = this._config.customRangeButtonLabel;\n\n    _renderer.setStyle(_element.nativeElement, 'display', 'block');\n    _renderer.setStyle(_element.nativeElement, 'position', 'absolute');\n  }\n\n  ngOnInit(): void {\n    this._positionService.setOptions({\n      modifiers: { flip: { enabled: this._config.adaptivePosition } },\n      allowedPositions: ['top', 'bottom']\n    });\n\n    this._positionService.event$?.pipe(take(1))\n      .subscribe(() => {\n        this._positionService.disable();\n\n        if (this._config.isAnimated) {\n          this.animationState = this.isTopPosition ? 'animated-up' : 'animated-down';\n\n          return;\n        }\n\n        this.animationState = 'unanimated';\n      });\n    this.containerClass = this._config.containerClass;\n    this.isOtherMonthsActive = this._config.selectFromOtherMonth;\n    this._effects?.init(this._store)\n      // intial state options\n      // todo: fix this, split configs\n      .setOptions(this._config)\n      // data binding view --> model\n      .setBindings(this)\n      // set event handlers\n      .setEventHandlers(this)\n      .registerDatepickerSideEffects();\n\n    // todo: move it somewhere else\n    // on selected date change\n    this._subs.push(\n      this._store\n        .select(state => state.selectedRange)\n        .subscribe(dateRange => {\n          this.valueChange.emit(dateRange);\n          this.chosenRange = dateRange || [];\n        })\n    );\n  }\n\n  get isTopPosition(): boolean {\n    return this._element.nativeElement.classList.contains('top');\n  }\n\n  positionServiceEnable(): void {\n    this._positionService.enable();\n  }\n\n  daySelectHandler(day: DayViewModel): void {\n    if (!day) {\n      return;\n    }\n    const isDisabled = this.isOtherMonthsActive ? day.isDisabled : (day.isOtherMonth || day.isDisabled);\n\n    if (isDisabled) {\n      return;\n    }\n    this.rangesProcessing(day);\n  }\n\n  monthSelectHandler(day: CalendarCellViewModel): void {\n    if (!day || day.isDisabled) {\n      return;\n    }\n\n    day.isSelected = true;\n\n    if (this._config.minMode !== 'month') {\n      if (day.isDisabled) {\n        return;\n      }\n      this._store.dispatch(\n        this._actions.navigateTo({\n          unit: {\n            month: getMonth(day.date),\n            year: getFullYear(day.date)\n          },\n          viewMode: 'day'\n        })\n      );\n\n      return;\n    }\n    this.rangesProcessing(day);\n  }\n\n  yearSelectHandler(day: CalendarCellViewModel): void {\n    if (!day || day.isDisabled) {\n      return;\n    }\n\n    day.isSelected = true;\n\n    if (this._config.minMode !== 'year') {\n      if (day.isDisabled) {\n        return;\n      }\n      this._store.dispatch(\n        this._actions.navigateTo({\n          unit: {\n            year: getFullYear(day.date)\n          },\n          viewMode: 'month'\n        })\n      );\n\n      return;\n    }\n    this.rangesProcessing(day);\n  }\n\n  rangesProcessing(day: CalendarCellViewModel): void {\n    // if only one date is already selected\n    // and user clicks on previous date\n    // start selection from new date\n    // but if new date is after initial one\n    // than finish selection\n\n    if (this._rangeStack.length === 1) {\n      this._rangeStack =\n        day.date >= this._rangeStack[0]\n          ? [this._rangeStack[0], day.date]\n          :  [day.date];\n    }\n\n    if (this._config.maxDateRange) {\n      this.setMaxDateRangeOnCalendar(day.date);\n    }\n\n    if (this._rangeStack.length === 0) {\n      this._rangeStack = [day.date];\n\n      if (this._config.maxDateRange) {\n        this.setMaxDateRangeOnCalendar(day.date);\n      }\n    }\n\n    this._store.dispatch(this._actions.selectRange(this._rangeStack));\n\n    if (this._rangeStack.length === 2) {\n      this._rangeStack = [];\n    }\n  }\n\n  ngOnDestroy(): void {\n    for (const sub of this._subs) {\n      sub.unsubscribe();\n    }\n    this._effects?.destroy();\n  }\n\n  setRangeOnCalendar(dates: BsCustomDates): void {\n    if (dates) {\n      this._rangeStack = dates.value instanceof Date ? [dates.value] : dates.value;\n    }\n    this._store.dispatch(this._actions.selectRange(this._rangeStack));\n  }\n\n  setMaxDateRangeOnCalendar(currentSelection: Date): void {\n    let maxDateRange = new Date(currentSelection);\n\n    if (this._config.maxDate) {\n      const maxDateValueInMilliseconds = this._config.maxDate.getTime();\n      const maxDateRangeInMilliseconds = currentSelection.getTime() + ((this._config.maxDateRange || 0) * dayInMilliseconds );\n      maxDateRange = maxDateRangeInMilliseconds > maxDateValueInMilliseconds ?\n        new Date(this._config.maxDate) :\n        new Date(maxDateRangeInMilliseconds);\n    } else {\n      maxDateRange.setDate(currentSelection.getDate() + (this._config.maxDateRange || 0));\n    }\n\n    this._effects?.setMaxDate(maxDateRange);\n  }\n}\n"]}